<html>
<!-- -->
<!-- 해더 -->

<head>
    <meta charset="utf-8">
    <title>리모콘 테스트</title>
    <link rel="stylesheet" type="text/css" href="test.css">
</head>
<!-- 바디 -->

<body onload="setWidgetList();">
    <div id="wrap">
        <header onclick="setMode();">여기가 로고</header>
        <div id="clear"></div>
        <div id="board" onclick="pos(event);">여기에 드래그</div>
        <aside id="remote"> </aside>
    </div>
</body>
<script type="text/javascript" language="javascript">

    // 리모콘 위젯 리스트
    var listWidget = [];
    // 보드 위젯 리스트
    var listBoard = [];
    // 마우스 클래스
    var obMouse = new mouse();
    /*************************************************************************************/
    // 보드부분 마우스 클릭 이벤트
    function pos(event) {
        // 마우스에 객체가 없을경우 return;
        if(!obMouse.getHave()) return;
        obMouse.setLocation(event.pageX, event.pageY);
    }

    function setMode() {
        // listBorad에 저장된 태그와
        // 좌표를 이용하여 div를 iframe으로 바꿈
        for (var i in listBoard){
            // div에서 좌표를 받아옴
            var div = listBoard[i];

            // 집어 넣는부분 
            div.innerHTML = div.getObjectTag();

            // 넣은거 빼는부분
            div.innerHTML = div.id + " 수정됨";
        }
    }

    /*************************************************************************************/
    function clearRemoteList(){
        for (var i in listWidget){
            listWidget[i].clearSelect();
        }
    }

    function fillRemoteList(){
        for (var i in listWidget){
            listWidget[i].fillWidgetIcon();
        }
    }

    function setWidgetList() {
        /**
         * 매번 실행시 마다
         * 생성한 것을 받아오는 함수 필요
         * 데이터 베이스에서 이름에 따른 태그가 필요함
         */
        
        // 리스트에 더하고
        // 여기서 같은 위젯 중복을 불가해야 한다.
        addWidget('초아', "<iframe width='560' height='315' src='https://www.youtube.com/embed/G9zL-A78oRg' frameborder='0' allowfullscreen></iframe>", obMouse);
        addWidget('태연', '<iframe width="560" height="315" src="https://www.youtube.com/embed/Ri6wvGjuoOg" frameborder="0" allowfullscreen></iframe>', obMouse);
    }

    /*************************************************************************************/
    /**
     * 리모콘 위젯 클래스
     */
    function addWidget(name, tag, mouse) {

        // 리모콘의 div 생성
        var div = document.createElement("div");

        div.id = name;
        var widgetTag = tag;
        var select = 0;

        // div css 부분
        div.innerText = name;
        div.style.margin = "5";
        div.style.width = "105px";
        div.style.height = "50px";
        div.style.float = "left";

        div.style.backgroundColor = "lightgreen";
        div.style.border = "1px dotted yellow";

        div.onclick = function() {

            // 일단 리스트를 초기화
            clearRemoteList();
            // 클릭시 값을 집어넣고
            select = 1;
            // 색칠 함수
            fillRemoteList();

            // 클릭시 마우스가 위젯의 값을 가진다
            mouse.setWidget(name, widgetTag);
        };

        div.clearSelect = function() {
            select = 0;
        }

        div.fillWidgetIcon = function(){
            if (select) {
                div.style.backgroundColor = "yellow";
                div.style.border = "1px dotted red";
            }
            else{
                div.style.backgroundColor = "lightgreen";
                div.style.border = "1px dotted yellow";
            }
        }

        document.getElementById('remote').appendChild(div);
        listWidget.push(div);
    }

    /**
     * 마우스 클래스
     * 리모콘에서 위젯을 선택하면
     * 그 위젯값을 가지고 있다가 배치해줌
     */
    function mouse() {
        // 마우스가 현제 객체를 가지고 있는지의 여부
        var have = 0;
        var widgetTag;
        var name;

        //좌표
        var px, py;

        this.setWidget = function(name, tag) {
            have = 1;
            this.name = name;
            this.widgetTag = tag;
        }

        this.setLocation = function(x, y) {
            // 태크에서 위젯의 사이즈만 받아서 배치시킴
            // 태그에서 크기만 받은 가짜 div
            // alert(x + "/"+ y);
            var div = document.createElement("div");
            var objectTag = this.widgetTag;
            div.id = this.name + "widget (더블클릭하면 삭제)";
            div.innerText = div.id;
            // iframe 태그에서 크기를 받아왔다 치고!
            // 
            // 
            div.style.width = "560px";
            div.style.height = "315px";
            div.style.backgroundColor = "red";
            div.style.position = "absolute";
            div.style.left = x + "px";
            div.style.top = y + "px";

            div.getObjectTag = function(){
                return objectTag;
            }
            // 위잿의 드래그 이벤트
            div.onmousedown = function(event) {
                // offsetLeft,offsetTop : 부모요소를 기준한 좌표지점.
                px = event.clientX - event.srcElement.offsetLeft;
                py = event.clientY - event.srcElement.offsetTop;
                flag = 1;
            };

            div.onmouseup = function(event) {
                px = event.clientX - event.srcElement.offsetLeft;
                py = event.clientY - event.srcElement.offsetTop;
                flag = 0;
            };

            div.onmousemove = function(event) {
                if (flag == 0)
                    return;

                if (x > 0)
                    event.srcElement.style.left = event.clientX - px + "px";
                if (y > 0)
                    event.srcElement.style.top = event.clientY - py + "px";
            };

            // 삭제함 
            div.ondblclick = function(event){
                document.getElementById('board').removeChild(this);
            }

            document.getElementById('board').appendChild(div);

            // div를 배치했기 때문에 초기화
            have = 0;

            // 진짜 div 태그를 리스트에 저장
            listBoard.push(div);

            // 리모콘을 초기화
            clearRemoteList();
            fillRemoteList();
        }

        this.getHave = function(){
            return have;
        }
    }
</script>
</html>
